!function(e,t){"use strict";var n,a=t(window).adaptTo("foundation-ui"),i=!1;function o(){return n.substr(0,n.lastIndexOf("/")),t.ajax({type:"GET",url:Granite.HTTP.externalize(n+".1.json"),cache:!1}).done(function(e,t,n){r()}).fail(function(e,i,o){var c,u,p;c=r,u={},u.title=t('input[name="jcr:title"]').val(),p=n.substr(0,n.lastIndexOf("/")),u.parentPath=p,u.cmd="createPage",u.template="/conf/schemaapp/settings/cloudconfigs/schemaapp",u.label="schemaAppConfig",t.ajax({type:"POST",url:Granite.HTTP.externalize("/bin/wcmcommand"),contentType:"application/x-www-form-urlencoded",data:u,cache:!1}).done(function(e,a,i){var o=t(e).find("#Location").attr("href");o&&(n=o),c()}).fail(function(e,t,n){a.notify(null,Granite.I18n.get("Failed to save configuration"),"error")})}),!1}function r(){var e=t("#edit-configuration-properties-form")[0],i=t(e).serializeArray();t.ajax({type:e.method,url:Granite.HTTP.externalize(n+"/jcr:content"),contentType:e.encType,data:t.param(i),cache:!1}).done(function(e,t,n){location.href=Granite.HTTP.externalize("/apps/schemaApp/utilities/schemaAppcloudconfig.html/etc/cloudservices/schemaapp")}).fail(function(e,t,n){a.notify(null,Granite.I18n.get("Failed to save configuration"),"error")})}function c(){t('#edit-configuration-properties-form input[aria-required="true"]').is(function(e){if(!t(this).val())return!0})?t(".dmconfig-sa-submit-btn").attr("disabled","disabled"):t(".dmconfig-sa-submit-btn").removeAttr("disabled")}function u(e){new Coral.Dialog().set({id:"delErrorDialog",variant:"error",header:{innerHTML:Granite.I18n.get("Error")},content:{innerHTML:"<p>"+e+"</p>"},footer:{innerHTML:'<button is="coral-button" variant="primary" coral-close size="M">'+Granite.I18n.get("Ok")+"</button>"}}).show()}function p(){var e=t('input[name="./apiKey"]').val(),n=t('input[name="./accountID"]').val(),i=t('input[name="./siteURL"]').val();if(!e){u(Granite.I18n.get("Please provide an Schema App API Key."));return}if(!n){u(Granite.I18n.get("Please provide the Schema App account's Id."));return}if(!i){u(Granite.I18n.get("Please provide the AEM Publisher URL."));return}a.wait(),t.ajax({type:"POST",url:Granite.HTTP.externalize("https://app.schemaapp.com/register/plugin"),headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8","x-api-key":e,"x-account-id":n},data:JSON.stringify({source:"AdobeExperienceManager",url:i,webhook:i+"/bin/schemaApp/WebhooksHandler.html"}),cache:!1}).done(function(e,t,n){a.clearWait(),"Registration Complete"!==e.status?(l(),a.notify(null,Granite.I18n.get("Connection has failed"),"error")):(a.notify(null,Granite.I18n.get("Your site has been registered with Schema App."),"Success"),c())}).fail(function(e,t,n){a.clearWait(),l(),a.notify(null,Granite.I18n.get("Connection has failed"),"error")})}function l(){t('input[name="./apiKey"]').val(""),t('input[name="./accountID"]').val(""),t('input[name="./siteURL"]').val("")}t(e).on("foundation-contentloaded",function(){if(!i){i=!0,n=t("#edit-configuration-properties-form").data("contentPath");var e=t("#edit-configuration-properties-form .foundation-layout-wizard2-title").text();t("#edit-configuration-properties-form .foundation-layout-wizard2-title").text(e),t(".cq-confadmin-schema-app-connect").on("click",p),c(),t("#edit-configuration-properties-form").on("submit",o)}})}(document,Granite.$);